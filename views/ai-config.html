{{template "layout/start"}}

<div class="container mx-auto p-6 max-w-4xl">
  <div class="mb-8">
    <h1 class="text-3xl font-bold mb-2">AI Configuration</h1>
    <p class="text-base-content/70">Configure AI automation and proactive features for Workspace Pro</p>
  </div>

  <!-- AI Status Card -->
  <div class="card bg-base-100 border border-base-300 shadow-lg mb-6">
    <div class="card-body">
      <h2 class="card-title">AI Service Status</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Ollama Status -->
        <div class="stat bg-base-200 rounded-lg">
          <div class="stat-title">Ollama Service</div>
          <div class="stat-value text-lg">
            {{if ai.IsAIEnabled}}
              <span class="text-success">✓ Running</span>
            {{else}}
              <span class="text-error">✗ Disabled</span>
            {{end}}
          </div>
          <div class="stat-desc">AI model: llama3.2:3b</div>
        </div>

        <!-- Queue Status -->
        <div class="stat bg-base-200 rounded-lg">
          <div class="stat-title">AI Queue</div>
          <div class="stat-value text-lg">
            {{with ai.GetQueueStats}}
              {{if .running}}
                <span class="text-success">✓ Active</span>
              {{else}}
                <span class="text-warning">⚠ Inactive</span>
              {{end}}
            {{else}}
              <span class="text-error">✗ Offline</span>
            {{end}}
          </div>
          <div class="stat-desc">
            {{with ai.GetQueueStats}}
              {{.queue_length}} queued, {{.processing}} processing
            {{else}}
              No queue data
            {{end}}
          </div>
        </div>
      </div>

      {{with ai.GetQueueStats}}
      <div class="mt-4 p-4 bg-base-200 rounded-lg">
        <h3 class="font-semibold mb-2">Queue Statistics</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
          <div>
            <span class="text-base-content/70">Total Processed:</span>
            <span class="font-semibold">{{.total_processed}}</span>
          </div>
          <div>
            <span class="text-base-content/70">Failed Tasks:</span>
            <span class="font-semibold">{{.total_failed}}</span>
          </div>
          <div>
            <span class="text-base-content/70">Avg Time:</span>
            <span class="font-semibold">{{.average_time_ms}}ms</span>
          </div>
          <div>
            <span class="text-base-content/70">Workers:</span>
            <span class="font-semibold">{{.workers}}</span>
          </div>
        </div>
      </div>
      {{end}}
    </div>
  </div>

  <!-- Automation Settings -->
  <div class="card bg-base-100 border border-base-300 shadow-lg mb-6">
    <div class="card-body">
      <h2 class="card-title mb-4">Automation Settings</h2>
      
      <form hx-post="/ai/config/update" hx-target=".error-message" hx-swap="innerHTML">
        <div class="space-y-4">
          
          <!-- Issue Triage -->
          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">
                <span class="font-semibold">Automatic Issue Triage</span>
                <span class="text-sm text-base-content/70 block">AI analyzes new issues and adds labels, priority, and initial response</span>
              </span>
              <input type="checkbox" name="enable_issue_triage" class="toggle toggle-primary" checked />
            </label>
          </div>

          <!-- PR Review -->
          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">
                <span class="font-semibold">Automatic PR Review</span>
                <span class="text-sm text-base-content/70 block">AI reviews code changes and provides feedback on new pull requests</span>
              </span>
              <input type="checkbox" name="enable_pr_review" class="toggle toggle-primary" checked />
            </label>
          </div>

          <!-- Auto Approve -->
          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">
                <span class="font-semibold">Auto-Approve Simple Changes</span>
                <span class="text-sm text-base-content/70 block">AI can approve documentation updates and minor fixes</span>
              </span>
              <input type="checkbox" name="enable_auto_approve" class="toggle toggle-warning" />
            </label>
          </div>

          <!-- Daily Reports -->
          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">
                <span class="font-semibold">Daily Repository Reports</span>
                <span class="text-sm text-base-content/70 block">Generate daily summaries of repository activity and health</span>
              </span>
              <input type="checkbox" name="enable_daily_reports" class="toggle toggle-primary" />
            </label>
          </div>

          <!-- Stale Issue Management -->
          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">
                <span class="font-semibold">Manage Stale Issues</span>
                <span class="text-sm text-base-content/70 block">AI comments on and optionally closes inactive issues</span>
              </span>
              <input type="checkbox" name="enable_stale_management" class="toggle toggle-warning" />
            </label>
          </div>

          <div class="divider"></div>

          <!-- AI Aggressiveness -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">AI Aggressiveness Level</span>
            </label>
            <select name="ai_aggressiveness" class="select select-bordered w-full">
              <option value="conservative">Conservative - Only suggest, never act</option>
              <option value="balanced" selected>Balanced - Act on clear cases</option>
              <option value="aggressive">Aggressive - Proactive automation</option>
            </select>
            <label class="label">
              <span class="label-text-alt text-xs">Controls how autonomous the AI is in making decisions</span>
            </label>
          </div>

          <!-- Response Time -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Response Delay (seconds)</span>
            </label>
            <input type="number" name="response_delay" value="30" min="0" max="300" class="input input-bordered w-full" />
            <label class="label">
              <span class="label-text-alt text-xs">Wait time before AI responds to new issues/PRs (0 for immediate)</span>
            </label>
          </div>

          <div class="error-message"></div>

          <div class="card-actions justify-end">
            <button type="submit" class="btn btn-primary">Save Configuration</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Recent AI Activity -->
  <div class="card bg-base-100 border border-base-300 shadow-lg">
    <div class="card-body">
      <h2 class="card-title mb-4">Recent AI Activity</h2>
      
      <div class="overflow-x-auto">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Time</th>
              <th>Type</th>
              <th>Repository</th>
              <th>Action</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {{range ai.GetRecentActivity}}
            <tr>
              <td class="text-xs">{{.CreatedAt.Format "15:04:05"}}</td>
              <td>
                <span class="badge badge-sm badge-outline">{{.Type}}</span>
              </td>
              <td>{{.RepoName}}</td>
              <td class="text-sm">{{.Description}}</td>
              <td>
                {{if .Success}}
                  <span class="text-success">✓</span>
                {{else}}
                  <span class="text-error">✗</span>
                {{end}}
              </td>
            </tr>
            {{else}}
            <tr>
              <td colspan="5" class="text-center text-base-content/50">No recent AI activity</td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </div>

      <div class="mt-4">
        <button class="btn btn-sm btn-outline" hx-get="/ai/activity" hx-target="closest tbody" hx-swap="innerHTML">
          Refresh Activity
        </button>
      </div>
    </div>
  </div>
</div>

{{template "layout/end"}}
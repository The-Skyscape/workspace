<!-- AI Chat Panel -->
<div class="flex flex-col h-full" id="ai-panel-content">
    <div class="flex flex-col h-full">
        <!-- Header -->
        <div class="sticky top-0 bg-base-100 border-b border-base-300 p-4">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold">AI Assistant</h3>
                    <p class="text-sm text-base-content/70">Your coding companion</p>
                </div>
                <button class="btn btn-primary btn-sm"
                        hx-post="{{host}}/ai/conversations"
                        hx-target="#ai-panel-content"
                        hx-swap="innerHTML">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    New Chat
                </button>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="p-4 border-b border-base-300">
            <div class="relative">
                <input type="search" 
                       placeholder="Search conversations..." 
                       class="input input-bordered input-sm w-full pl-10"
                       hx-get="{{host}}/ai/panel"
                       hx-trigger="input delay:300ms, search"
                       hx-target="#conversation-list"
                       hx-indicator="#search-spinner"
                       name="q">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <span id="search-spinner" class="htmx-indicator absolute right-3 top-1/2 transform -translate-y-1/2">
                    <span class="loading loading-spinner loading-xs"></span>
                </span>
            </div>
        </div>

        <!-- Conversation List -->
        <div class="flex-1 overflow-y-auto p-4">
            <div class="flex flex-col gap-2" id="conversation-list">
                {{if .}}
                    {{range .}}
                    <div class="card bg-base-100 border border-base-300 hover:border-primary/50 transition-all cursor-pointer"
                         hx-get="{{host}}/ai/chat/{{.ID}}"
                         hx-target="#ai-panel-content"
                         hx-swap="innerHTML">
                        <div class="card-body p-3">
                            <div class="flex justify-between items-start gap-2">
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-medium text-sm truncate">{{.Title}}</h4>
                                    {{if .LastMessage}}
                                    <p class="text-xs text-base-content/60 truncate mt-1">
                                        {{if eq .LastRole "user"}}You: {{end}}{{.LastMessage}}
                                    </p>
                                    {{end}}
                                    <p class="text-xs text-base-content/40 mt-1">
                                        {{.UpdatedAt.Format "Jan 2, 3:04 PM"}}
                                    </p>
                                </div>
                                <div class="dropdown dropdown-end" onclick="event.stopPropagation()">
                                    <label tabindex="0" class="btn btn-ghost btn-xs btn-square">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </label>
                                    <ul tabindex="0" class="dropdown-content menu p-2 shadow-lg bg-base-100 rounded-box w-32 border border-base-300">
                                        <li><a hx-delete="{{host}}/ai/conversations/{{.ID}}"
                                               hx-confirm="Delete this conversation?"
                                               hx-target="#ai-panel-content"
                                               hx-swap="innerHTML">Delete</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    {{end}}
                {{else}}
                    <div class="text-center py-8">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-base-content/30 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                        </svg>
                        <p class="text-base-content/60">No conversations yet</p>
                        <p class="text-sm text-base-content/40 mt-1">Start a new chat to begin</p>
                    </div>
                {{end}}
            </div>
        </div>
    </div>
</div>
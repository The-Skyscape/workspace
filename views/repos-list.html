{{template "layout/start"}}
<div class="container mx-auto px-4 py-6 max-w-6xl">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold">Repositories</h1>
      <p class="text-base-content/70 mt-2">Manage your Git repositories and code projects</p>
    </div>
    {{if or auth.CurrentUser.IsAdmin (eq auth.CurrentUser.Role "admin")}}
    <button class="btn btn-primary mt-4 sm:mt-0" _="on click call create_repo_modal.showModal()">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
      </svg>
      New Repository
    </button>
    {{else if auth.CurrentUser}}
    <div class="text-sm text-base-content/60 mt-4 sm:mt-0">
      Only administrators can create repositories
    </div>
    {{end}}
  </div>

  <!-- Search and Filters -->
  <div class="card bg-base-100 shadow-sm border border-base-300 mb-6">
    <div class="card-body p-4">
      <div class="flex flex-col lg:flex-row gap-4">
        <!-- Search Input -->
        <div class="flex-1">
          <div class="relative">
            <input type="text" 
                   id="repo-search" 
                   placeholder="Search repositories..." 
                   class="input input-bordered w-full pl-10"
                   hx-get="{{host}}/repos/search"
                   hx-trigger="keyup changed delay:300ms, search"
                   hx-target="#repos-list"
                   hx-include="#visibility-filter"
                   hx-indicator="#repos-list .htmx-indicator"
                   name="q">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <button class="btn btn-ghost btn-sm absolute right-1 top-1/2 transform -translate-y-1/2" 
                    _="on click set #repo-search.value to '' then trigger search on #repo-search">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Filter Tabs -->
        <div class="tabs tabs-boxed">
          <input type="radio" name="filter" id="visibility-filter" value="all" class="hidden" checked
                 hx-get="{{host}}/repos/search"
                 hx-trigger="change"
                 hx-target="#repos-list"
                 hx-include="#repo-search"
                 hx-indicator="#repos-list .htmx-indicator">
          <label for="filter-all" class="tab tab-active" _="on click set <[name=filter][value=all]/>.checked to true then trigger change on <[name=filter][value=all]/>">
            All
          </label>
          
          <input type="radio" name="filter" value="public" class="hidden"
                 hx-get="{{host}}/repos/search"
                 hx-trigger="change"
                 hx-target="#repos-list"
                 hx-include="#repo-search"
                 hx-indicator="#repos-list .htmx-indicator">
          <label for="filter-public" class="tab" _="on click set <[name=filter][value=public]/>.checked to true then trigger change on <[name=filter][value=public]/>">
            Public
          </label>
          
          <input type="radio" name="filter" value="private" class="hidden"
                 hx-get="{{host}}/repos/search"
                 hx-trigger="change"
                 hx-target="#repos-list"
                 hx-include="#repo-search"
                 hx-indicator="#repos-list .htmx-indicator">
          <label for="filter-private" class="tab" _="on click set <[name=filter][value=private]/>.checked to true then trigger change on <[name=filter][value=private]/>">
            Private
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Repository List -->
  <div id="repos-list" class="relative">
    <!-- Loading indicator -->
    <div class="htmx-indicator absolute inset-0 bg-base-100/80 flex items-center justify-center z-10 rounded-lg">
      <span class="loading loading-spinner loading-lg text-primary"></span>
    </div>
    {{template "repos-list-partial.html" home.UserRepos}}
  </div>
</div>

<!-- Include Shared Create Repository Modal -->
{{template "create-repo-modal.html" .}}
{{template "layout/end"}}
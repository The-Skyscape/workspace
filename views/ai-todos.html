<!-- AI Chat Todo Panel -->
<div id="todo-panel" class="border-b border-base-300 bg-base-200/30">
    <div class="collapse collapse-arrow">
        <input type="checkbox" class="peer" {{if .HasTodos}}checked{{end}} />
        <div class="collapse-title flex items-center py-2 px-4" style="min-height: 2.5rem;">
            <div class="flex items-center justify-between flex-1">
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    <span class="font-medium text-sm">Task List</span>
                    {{if .Todos}}
                    <span class="badge badge-sm badge-primary">{{.CompletedCount}}/{{.TotalCount}}</span>
                    {{end}}
                </div>
                {{if .Todos}}
                <div class="text-xs text-base-content/60">
                    {{.PercentComplete}}% complete
                </div>
                {{end}}
            </div>
        </div>
        <div class="collapse-content px-4">
            {{if .Todos}}
            <div class="space-y-1" 
                 hx-get="{{host}}/ai/chat/{{.ConversationID}}/todos"
                 hx-trigger="sse:todo-updated from:#sse-todos"
                 hx-swap="innerHTML">
                {{range .Todos}}
                <div class="flex items-start gap-2 py-1 group">
                    {{if eq .Status "completed"}}
                    <input type="checkbox" checked disabled class="checkbox checkbox-xs checkbox-success mt-0.5" />
                    <span class="text-sm line-through text-base-content/50">{{.Content}}</span>
                    {{else if eq .Status "in_progress"}}
                    <span class="loading loading-spinner loading-xs text-primary mt-0.5"></span>
                    <span class="text-sm text-primary font-medium">{{.Content}}</span>
                    {{else}}
                    <input type="checkbox" disabled class="checkbox checkbox-xs mt-0.5" />
                    <span class="text-sm text-base-content/80">{{.Content}}</span>
                    {{end}}
                </div>
                {{end}}
            </div>
            
            {{if gt .CompletedCount 0}}
            <div class="mt-3 pt-3 border-t border-base-300">
                <div class="w-full bg-base-300 rounded-full h-1.5">
                    <div class="bg-primary h-1.5 rounded-full transition-all duration-500" 
                         style="width: {{.PercentComplete}}%"></div>
                </div>
            </div>
            {{end}}
            {{else}}
            <div class="text-sm text-base-content/60 italic py-2">
                No tasks yet. The AI will create tasks as needed during complex operations.
            </div>
            {{end}}
        </div>
    </div>
</div>

<!-- SSE endpoint for todo updates -->
<div id="sse-todos" 
     hx-ext="sse" 
     sse-connect="{{host}}/ai/chat/{{.ConversationID}}/todos/stream"
     class="hidden"></div>
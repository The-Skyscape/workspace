{{template "layout/start"}}

<!-- Settings Header -->
<div class="navbar bg-base-100 border-b border-base-300">
  <div class="container mx-auto max-w-7xl px-4">
    <div class="flex-1">
      <h1 class="text-2xl font-bold">System Settings</h1>
      <p class="text-base-content/70">Configure your Skyscape instance</p>
    </div>
  </div>
</div>

<!-- Settings Container -->
<div class="container mx-auto px-4 py-6 max-w-7xl">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    {{template "settings-nav.html"}}

    <!-- Main Monitoring Content -->
    <div class="lg:col-span-2">
      <!-- Alert Banner -->
      <div id="alerts-container" hx-get="{{host}}/monitoring/partial/alerts" hx-trigger="every 5s" hx-swap="innerHTML" class="mb-4">
        {{template "monitoring-alerts.html" .}}
      </div>

      <!-- Main Stats Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <!-- CPU Card -->
        <div class="card bg-base-100 shadow-sm border border-base-300" id="cpu-card" 
             hx-get="{{host}}/monitoring/partial/cpu" hx-trigger="every 2s" hx-swap="innerHTML">
          {{template "monitoring-cpu.html" .}}
        </div>

        <!-- Memory Card -->
        <div class="card bg-base-100 shadow-sm border border-base-300" id="memory-card"
             hx-get="{{host}}/monitoring/partial/memory" hx-trigger="every 2s" hx-swap="innerHTML">
          {{template "monitoring-memory.html" .}}
        </div>

        <!-- Disk Card -->
        <div class="card bg-base-100 shadow-sm border border-base-300" id="disk-card"
             hx-get="{{host}}/monitoring/partial/disk" hx-trigger="every 5s" hx-swap="innerHTML">
          {{template "monitoring-disk.html" .}}
        </div>

        <!-- System Info Card -->
        <div class="card bg-base-100 shadow-sm border border-base-300">
          <div class="card-body">
            <h3 class="card-title text-lg">System Info</h3>
            {{with monitoring.GetCurrentStats}}
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-base-content/70">CPU Cores</span>
                <span class="font-mono">{{.CPU.Cores}}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-base-content/70">Load Average</span>
                <span class="font-mono">{{printf "%.2f" .LoadAverage.Load1}}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-base-content/70">Processes</span>
                <span class="font-mono">{{.Processes.Total}}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-base-content/70">Running</span>
                <span class="font-mono">{{.Processes.Running}}</span>
              </div>
            </div>
            {{end}}
          </div>
        </div>
      </div>

      <!-- Docker Containers Section -->
      <div class="card bg-base-100 shadow-sm border border-base-300 mb-6">
        <div class="card-body">
          <h2 class="card-title">Docker Containers</h2>
          <div id="containers-table" hx-get="{{host}}/monitoring/partial/containers" hx-trigger="every 5s" hx-swap="innerHTML">
            {{with monitoring.GetContainers}}
            {{if .}}
            <div class="overflow-x-auto">
              <table class="table table-zebra table-sm">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>CPU</th>
                    <th>Memory</th>
                    <th>Network I/O</th>
                    <th>Block I/O</th>
                  </tr>
                </thead>
                <tbody>
                  {{range .}}
                  <tr>
                    <td class="font-mono text-xs">{{.Name}}</td>
                    <td>
                      {{if eq .Status "running"}}
                      <span class="badge badge-success badge-sm">Running</span>
                      {{else if eq .Status "exited"}}
                      <span class="badge badge-error badge-sm">Exited</span>
                      {{else}}
                      <span class="badge badge-warning badge-sm">{{.Status}}</span>
                      {{end}}
                    </td>
                    <td class="font-mono text-xs">
                      <span class="{{if gt .CPUPercent 80.0}}text-error{{else if gt .CPUPercent 50.0}}text-warning{{end}}">
                        {{printf "%.1f%%" .CPUPercent}}
                      </span>
                    </td>
                    <td class="font-mono text-xs">
                      <span class="{{if gt .MemPercent 90.0}}text-error{{else if gt .MemPercent 70.0}}text-warning{{end}}">
                        {{monitoring.FormatBytes .MemUsage}} ({{printf "%.1f%%" .MemPercent}})
                      </span>
                    </td>
                    <td class="font-mono text-xs">{{.NetIO}}</td>
                    <td class="font-mono text-xs">{{.BlockIO}}</td>
                  </tr>
                  {{end}}
                </tbody>
              </table>
            </div>
            {{else}}
            <div class="text-center py-8 text-base-content/50">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
              </svg>
              <p>No Docker containers running</p>
            </div>
            {{end}}
            {{else}}
            <div class="text-center py-8 text-base-content/50">
              <span class="loading loading-spinner loading-lg"></span>
              <p class="text-sm mt-2">Loading container data...</p>
            </div>
            {{end}}
          </div>
        </div>
      </div>

      <!-- Detailed Stats Section -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Network Stats -->
        <div class="card bg-base-100 shadow-sm border border-base-300">
          <div class="card-body">
            <h3 class="card-title">Network Usage</h3>
            {{with monitoring.GetCurrentStats}}
            <div class="space-y-3">
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Bytes Received</span>
                  <span class="text-sm font-mono">{{monitoring.FormatBytes .Network.BytesRecv}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Bytes Sent</span>
                  <span class="text-sm font-mono">{{monitoring.FormatBytes .Network.BytesSent}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Packets Received</span>
                  <span class="text-sm font-mono">{{.Network.PacketsRecv}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Packets Sent</span>
                  <span class="text-sm font-mono">{{.Network.PacketsSent}}</span>
                </div>
              </div>
            </div>
            {{end}}
          </div>
        </div>

        <!-- Process Stats -->
        <div class="card bg-base-100 shadow-sm border border-base-300">
          <div class="card-body">
            <h3 class="card-title">Process Statistics</h3>
            {{with monitoring.GetCurrentStats}}
            <div class="space-y-3">
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Total Processes</span>
                  <span class="text-sm font-mono">{{.Processes.Total}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Running</span>
                  <span class="text-sm font-mono text-success">{{.Processes.Running}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Sleeping</span>
                  <span class="text-sm font-mono">{{.Processes.Sleeping}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Stopped</span>
                  <span class="text-sm font-mono text-warning">{{.Processes.Stopped}}</span>
                </div>
              </div>
              <div>
                <div class="flex justify-between mb-1">
                  <span class="text-sm text-base-content/70">Zombie</span>
                  <span class="text-sm font-mono text-error">{{.Processes.Zombie}}</span>
                </div>
              </div>
            </div>
            {{end}}
          </div>
        </div>
      </div>

      <!-- Auto-refresh indicator -->
      <div class="mt-6 text-center text-sm text-base-content/50">
        <span class="inline-flex items-center gap-2">
          <span class="loading loading-ring loading-xs"></span>
          Auto-refreshing every 2 seconds
        </span>
      </div>
    </div>
  </div>
</div>

{{template "layout/end"}}